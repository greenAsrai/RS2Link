% !TEX root = ./main_TCS.tex


%\section{Background on Core Network Algebra (CNA)}
%We briefly report the basic concepts of the \CNA~calculus.
%
%\paragraph{Links and link chains}
%A link is a pair $\link{\alpha}{\beta}$
%that records the source and the target sites 
%of a communication,  meaning that the input available 
%at the source site $\alpha$ can be forwarded to the target one $\beta$.  
%Links are suitably combined in link chains to describe 
%how information can be routed across processes before 
%arriving at their destination.
%
%More formally, let $\mathcal{C}$ be the set of channels, ranged over by $a,b,c,...$, and 
%let $\mathcal{A} = \mathcal{C} \cup \setof{\silent} \cup \setof{{\noacts}}$ be the set of actions, ranged over by $\alpha,\beta,\gamma,...$,
%where the symbol $\silent$ denotes a \emph{silent} action, while the symbol $\noact$ denotes a \emph{virtual} (non-specified) action.
%A \emph{link} is a pair $\ell=\link{\alpha}{\beta}$;
% it can be read as forwarding the input available on $\alpha$ to $\beta$, and we call $\alpha$ the \emph{source site} of $\ell$ and $\beta$ the \emph{target site} of $\ell$.
%%
%A link $\link{\alpha}{\beta}$ is \emph{solid} if $\alpha,\beta \neq \ \noacts$; 
%the link $\link{\noact}{\noact}$ is called \emph{virtual}.
%A link is \emph{valid} if it is solid or virtual.
%We let $\mathcal{L}$ be the set of valid links.
%% ranged over by $p,q,r,...$.
%
%All the  processes that want to participate to a single interaction, must offer
% a link chain composed the same number of links: each link chain must
% be formed by only one solid link and all the other ones must be virtual.
% The positions of the solid links in each chain must be different and 
% sibling links must be such that the 
%right hand channel of the previous link must match with the left hand channel of the
%next link.  Please note that virtual links match with any channel name.
%
%More formally, a \emph{link chain} is a 
%finite sequence $s = \ell_{1}...\ell_{n}$ of (valid) links  $\ell_{i} = \link{\alpha_{i}}{\beta_{i}}$ such that:
%\begin{enumerate}
%
%\item for any $i\in [1,n-1]$, 
%$\left\{\begin{array}{ll}
%\beta_{i},\alpha_{i+1}\in \mathcal{C} & \mbox{ implies } \beta_{i} = \alpha_{i+1}\\
%\beta_{i}=\silent & \mbox{ iff } \alpha_{i+1}=\silent
%\end{array}\right.
%$
%\item  $\exists i \in [1,n]. \ \ell_i \neq \link{\noact}{\noact}$.
%\end{enumerate}
%
%
%\paragraph{Syntax and semantics}
%
%The syntax of \CNA is as follow:
%
%
%\begin{definition}
%The \CNA\ processes are generated by the following grammar:
%\[
%\begin{array}{rcl}
%P,Q & ::= &
%\nil \prodsep
%%X \prodsep
%\ell. P  \prodsep
%P+Q \prodsep
%P|Q \prodsep
%\restrict{a} P \prodsep
%P[\phi] \prodsep
%A
%\end{array}
%\]
%\noindent
%where $\ell$ is a solid link ( i.e.\  $\ell = \link{\alpha}{\beta}$ with $\alpha,\beta\neq \ \noacts$) and $A$ is a process identifier for which we assume a definition $A \defeq P$ is available in a given set $\Delta$ of (possibly recursive) process definitions.
%\end{definition}
%
%The operational semantics is defined in terms of a Labelled Transition System, in which states are \CNA\ processes, labels are link chains, and transitions are generated by the SOS rules in Figure~\ref{fig:cnasos}.  The semantics makes use of the an equivalence relation that allow rule  $(Act)$ 
%of the semantics to decide the dimention (i.e. the maximum number of the participants) of the
%interaction a process want to take part in.
%
%\begin{definition}[Equivalence $\blackstretcheq$]\label{def:black}
%We let $\blackstretcheq$ be the least equivalence relation 
%%(i.e.~closed under reflexivity, symmetry and transitivity) 
%over link chains closed under the axioms (whenever both sides are well defined link chains):
%\[
%\begin{array}{rclcrcl}
%s\link{\noact}{\noact} & \blackstretcheq &  s & \qquad &
%s_1 \startchain{\noact}\chainedlink{\noact}{\noact}\chainend{\noact}s_2 & \blackstretcheq & s_1 \link{\noact}{\noact} s_2\\
%\link{\noact}{\noact}s & \blackstretcheq & s & &
%s_1 \startchain{\alpha}\chainedlink{a}{a}\chainend{\beta} s_2
%& \blackstretcheq & 
%s_1 \startchain{\alpha}\chainedlink{a}{\noact}\chainedlink{\noact}{a}\chainend{\beta}s_2 
%\end{array}
%\]
%\end{definition}
%
%
%
%\begin{figure}[t]
%\begin{center} 
%\begin{prooftree} 
%\AxiomC{$s \blackstretcheq \ell $} %\mbox{($\ell$ {\em only} solid link in $s$)}
%\RightLabel{\scriptsize(\textit{Act})}
%\UnaryInfC{$\ell.P \xrightarrow{s} P$} 
%\DisplayProof
%\
%\AxiomC{$P \xrightarrow{s} P'$} 
%\RightLabel{\scriptsize(\textit{Lsum})}
%\UnaryInfC{$P+Q \xrightarrow{s} P'$} 
%\DisplayProof
%\
%\AxiomC{$P \xrightarrow{s} P'$} 
%\RightLabel{\scriptsize(\textit{Res})}
%\UnaryInfC{$\restrict{a}P \xrightarrow{\restrict{a}s} \restrict{a}P'$} 
%%\DisplayProof
%%\,
%%\AxiomC{$Q \xrightarrow{s} Q'$} 
%%\RightLabel{\scriptsize(Rsum)}
%%\UnaryInfC{$P+Q \xrightarrow{s} Q'$} 
%\end{prooftree} 
%\end{center}
%
%\begin{center} 
%\begin{prooftree} 
%\AxiomC{$P \xrightarrow{s} P'$} 
%\RightLabel{\scriptsize(\textit{Rel})}
%\UnaryInfC{$P[\phi] \xrightarrow{s[\phi]} P'[\phi]$} 
%\DisplayProof
%\
%\AxiomC{$P \xrightarrow{s} P'$} 
%\RightLabel{\scriptsize(\textit{Lpar})}
%\UnaryInfC{$P|Q \xrightarrow{s} P'|Q$} 
%\DisplayProof
%\ 
%%\AxiomC{$Q \xrightarrow{s} Q'$} 
%%\RightLabel{\scriptsize(Rpar)}
%%\UnaryInfC{$P|Q \xrightarrow{s} P|Q'$} 
%%\end{prooftree} 
%%\end{center}
%%\begin{center} 
%%\begin{prooftree} 
%\AxiomC{$P \xrightarrow{s} P'$} 
%\AxiomC{$Q \xrightarrow{s'} Q'$} 
%\RightLabel{\scriptsize(\textit{Com})}
%\BinaryInfC{$P|Q \xrightarrow{\merges{s}{s'}} P'|Q'$} 
%\DisplayProof
%\end{center}
%\begin{center}
%%\AxiomC{$P[\subst{\recproc{X}{P}}{X}] \xrightarrow{s} P'$} 
%%\RightLabel{\scriptsize(Rec)}
%%\UnaryInfC{$\recproc{X}{P} \xrightarrow{s} P'$} 
%\AxiomC{$P \xrightarrow{s} P'$}
% \AxiomC{$(A \defeq P)\in\Delta$}
%\RightLabel{\scriptsize(\textit{Ide})}
%\BinaryInfC{$A \xrightarrow{s} P'$} 
%\end{prooftree} 
%\end{center}
%\caption{SOS semantics of the \CNA\  (rules (\textit{Rsum}) and (\textit{Rpar}) are omitted).}
%\label{fig:cnasos}
%\end{figure}
%






\newpage

\section{Omitted Proofs}
In this section we report the proofs for the results in Section~\ref{sec:trans} and in Section~\ref{sec:biosimulation}.
%\noindent
%We recall Lemma~\ref{lem:struct} (the original appears on p.\,\pageref{lem:struct}).

\lemmastruct*
\begin{proof}
  We prove the two items separately:
  \begin{enumerate}
\item by Definition~\ref{def:trans}, all the names that appear in the prefixes of any subprocess are in the set $\mathit{names}$ and thus restricted. 
They include all the reaction names $r_j$, all the production names $p_j$, all the entity names $s_i,s_o$, in all their decorated versions, and the name $\mathit{cxt}$. 
Therefore the chain $\upsilon$ must start and end with a $\silent$ action and cannot contain virtual links.
The only prefix that starts with $\silent$ is the one of the recursive init process $I$ (prefix $\link{\silent}{r_1}$) and the only prefixes that end with $\silent$ are those associated to reaction $a_u$ (as we have assumed that $p_{u+1} = \silent$, where $u$ is the number of reactions).
Then each prefix that starts with $r_j$ involves $p_j$ and $r_{j+1}$.
Thus all the prefixes associated with reactions must be concatenated and also the prefix associated with the context (remember that $r_{u+1} = \mathit{cxt}$), forming the backbone of the label.
Since the context processes is involved, then all entities processes are also involved.
Then, all the processes $I$, $P_a$, $P_s$ (or $\overline{P_s}$), and $\mathit{Cxt}_1$  must participate to each transition.
 \item for each reaction $aj \in A$, the c\CNA \ code of  $P_{aj}$ leaves one virtual link between two solid links of the types $\link{r_j}{\dots} \chainedlink{s_{i}}{\noact}\chainedlink{\noact}{s_{o}}\link{}{\dots}\link{}{r_{j+1}} {\dots}\link{p_j}{\dots}\link{}{p_{j+1}}$. Then, it derives that the process $P_{s}$, encoding the behaviour of entity $s$, can participate by filling the virtual link in the above transition by only offering one solid link of the form $\link{s_{i}}{s_{o}}$. In fact, there is no other way to generate a solid chain from $s_{i}$ to $s_{o}$.
 The same reasoning holds for the processes $\mathit{Cxt}_1$ and for all the decorated versions of $s_i,s_o$.
% $P_{s_1}$ can not participate with a link chain, as by juxtaposing  $\link{s_{1i}}{s_{1o}}$, not valid
 %link chains would be generated.
   \end{enumerate}
  \end{proof}
  
  
%\noindent
%We recall Proposition~\ref{prop:corr1}
%(the original appears on p.\,\pageref{prop:corr1}).
\propcorruno*
 
 %\begin{proposition}(correctness 1)\\
 %\label{lem:struct}
%  Let ${\cal A} = (S, A)$ be a rs, and let  $\pi=(\gamma,\delta)$ be a $n$-step interactive process in $A$, with
% $\gamma = C_0,\dots,C_n$ and $\delta = D_0,\dots,D_n$.
%% We define $\pi' = (\gamma',\delta')$ with $\gamma' = C_0',\dots,C_{n-1}'$ and $\delta' = D_0',\dots,D_{n-1}'$ as $C_0' = C_1 \cup D_1$,  and
%% $C_i' = C_{i+1}$, $D_{i}' = D_{i+1}$ with $ 1 \leq i < n$.
%  Let   $P=[|{\cal A},\gamma|]$ be  its c\CNA~translation, and let $P'$ be such that $P \xrightarrow{\link{\silent}{\silent}}P'$.% then $P' = [|{\cal A},\gamma' |]$. 
%Then it holds that\\
% $P= \restrict{reacts,ctxs,ents} (\Pi_{a \in A}P_a| \Pi_{s \in S}CXT_s | \Pi_{s \in C_0}P_s| \Pi_{s \notin C_0}\overline{P}_s)$\\
% $P'= \restrict{reacts,ctxs,ents} (\Pi_{a \in A}P_a| \Pi_{s \in S}CXT_s | \Pi_{s \in C_1 \cup D_1}P_s| \Pi_{s \notin C_1 \cup D_1}\overline{P}_s)$
 %\end{proposition}
 \begin{proof}
 First, we note that all the channels in the system are restricted, see Def.~\ref{def:trans}, then
 it holds that the transition labels are of the form  $v=\link{\silent}{\silent}\dots\link{\silent}{\silent}$.\\
 Now,
by Definition~\ref{def:trans} and by Lemma~\ref{lem:struct}.1, all the  channels $r_j,p_j$, with
 $j \in [1,\dots,u]$, and $cxt$,
 %$cxt_h$, with $h \in [1, \dots, w]$,
  and all the annotated versions of 
 $s_i$, $s_o$ are restricted. Also, processes $\mathit{Cxt}_1$ always requires the 
 interaction with $P_s$ on either on channels $\widehat{s}_i$, $\widehat{s}_o$ or on channels 
 $\underline{s}_i$, $\underline{s}_o$.
 It derives that all the processes: $P_a$  (coding the behaviour of reaction $a \in A$), $P_s$ (coding the behaviour of entity $s \in S$), and $\mathit{Cxt}_1$ (coding the behaviour of the context regarding all the entities) have been involved in the transition. 

For any process $P_{aj}$ encoding a reaction $aj$ we have the following cases:
\begin{description}
\item[(a)] 
if $aj$ is applicable and it produces the entity $s$,  
the process $P_{aj}$ provides a code of this type:
%By Lemma~\ref{lem:compl1}, all the processes $A_j$, and $Cxt_h$ participated in the tr
%The code executed by any process encoding rule $R_i$ producing $e$ is 
$$P_{aj}\defeq \link{r_j}{\dots}\chainedlink{r_{j+1}}{\noact}\chainedlink{\noact}{p_j}\link{}{\dots}\chainedlink{\widetilde{s}_i}{\noact}\chainedlink{\noact}{\widetilde{s}_o}\link{}{\dots} \chainend{p_{j+1}}.P_{aj} ;$$

\item[(b)] 
 if $aj$ is applicable and it  consumes the entity $s$,
 the process $P_{aj}$ provides a code of this type: 
$$P_{aj}\defeq \link{r_j}{\dots}\chainedlink{s_i}{\noact}\chainedlink{\noact}{s_o}\link{}{\dots} \chainedlink{r_{j+1}}{\noact}\chainedlink{\noact}{p_j}\link{}{\dots}\link{}{p_{j+1}}.P_{aj} ;$$

\item[(c)]  
 if $aj$ is applicable and it requires the absence of the entity $s$,
 the process $P_{aj}$  provides a code of this type: 
$$P_{aj}\defeq \link{r_j}{\dots}\chainedlink{\overline{s}_i}{\noact}\chainedlink{\noact}{\overline{s}_o}\link{}{\dots} \chainedlink{r_{j+1}}{\noact}\chainedlink{\noact}{p_j}\link{}{\dots}\link{}{p_{j+1}}.P_{aj} ;$$

\item[(d)] 
 if $aj$ is not applicable,
the process $P_{aj}$ executes a code  capturing either the absence of one of its reactants (case 1), or the presence  of one of its inhibitors (case 2):
\begin{enumerate}
\item $P_{aj}\defeq \link{r_j}{\dots}\chainedlink{\overline{s}_i}{\noact}\chainedlink{\noact}{\overline{s}_o}\link{}{\dots} \chainedlink{r_{j+1}}{\noact}\chainedlink{\noact}{p_j}\link{}{\dots}\link{}{p_{j+1}}.P_{aj} $;
\item $P_{aj}\defeq \link{r_j}{\dots}\chainedlink{s_i}{\noact}\chainedlink{\noact}{s_o}\link{}{\dots} \chainedlink{r_{j+1}}{\noact}\chainedlink{\noact}{p_j}\link{}{\dots}\link{}{p_{j+1}} .P_{aj}$.
\end{enumerate}
\end{description}
%It is worth nothing that there could be other processes $P_a$ encoding  a reaction $a \in A$ that do not
%involve the entity $s$.\\
Now, we consider the structure of the process $\mathit{Cxt}_1$. 
By Definition~\ref{def:trans}, $Cxt_1$ is the unique process encoding the behaviour of the context regulating the supply of any entity. 

\begin{description}
\item[(e)] 
The code of the process $Cxt_1$ that provides $s$ and not $e$ has the following structure: 
$$
\mathit{Cxt}_1 \defeq
\link{\mathit{cxt}}{\dots}
\chainedlink{\widehat{s}_i}{\noact}\chainedlink{\noact}{\widehat{s}_o}\link{}{\dots} 
\chainedlink{\underline{e}_i}{\noact}\chainedlink{\noact}{}\link{\underline{e}_o}{\dots} 
\chainend{p_{1}}. \mathit{Cxt}_{2} .
$$
\end{description}


%$R_j \defeq \startchain{rule_j}\chainedlink{e_i}{\noact}\chainedlink{\noact}{e_o}\chainedlink{\overline{e'}_i}{\noact} \chainedlink{\noact}{\overline{e'}_o}\chainedlink{\widetilde{e''}_i}{\noact}\chainedlink{\noact}{\widetilde{e''}_o} \chainend{rule_{j+1}}.R_j + \dots$, with $e',e''\neq e $.\\
%The code executed by any rule $j$ not requiring $e$ is $R_j \defeq \startchain{rule_j}\chainedlink{e_i}{\noact}\chainedlink{\noact}{e_o} \chainend{rule_{j+1}}.R_j + \dots$.\\
\noindent
The code executed by  $P_s$ has the following structure:
\begin{description}
\item[(f)] 
$P_s \defeq  \sum_{h,k\geq0}(\startchain{s_i}\chainedlink{s_o}{\noact}\chainend{\noact}) ^h\, \startchain{\widehat{s}_i}\chainedlink{\widehat{s}_o}{\noact}\chainend{\noact}
 (\startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact})^k\,.P_s $, if $s \in C_{i+1}$;
% \underbrace{ \startchain{s_i}\chainedlink{s_o}{\noact}\chainedlink{\noact}{s_i}\chainedlink{s_o}{\noact}\chainend{\noact}...}_{v\ times}\underbrace{ \startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainedlink{\noact}{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact}...}_{z\ times}\link{\widehat{s}_i}{\widehat{s}_o}.P_s $, if $s \in C_{i+1}$;
%\item[()] $P_s \defeq  \underbrace{ \startchain{s_i}\chainedlink{s_o}{\noact}\chainedlink{\noact}{s_i}\chainedlink{s_o}{\noact}\chainend{\noact}...}_{v\ times}\link{\widehat{s}_i}{\widehat{s}_o}.P_s $, if $s \in C_1$ %(and hence $s \in C_0'$)
\item[(g)] 
$P_s \defeq \sum_{h \geq 0,k\geq 1}(\startchain{s_i}\chainedlink{s_o}{\noact}\chainend{\noact})^h\ \startchain{\underline{s}_i}\chainedlink{\underline{s}_o}{\noact}\chainend{\noact} (\startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact})^k
.P_s$, if $s \not\in C_{i+1}$
% \underbrace{ \startchain{s_i}\chainedlink{s_o}{\noact}\chainedlink{\noact}{s_i}\chainedlink{s_o}{\noact}\chainend{\noact}...}_{v\ times}\underbrace{ \startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainedlink{\noact}{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact}...}_{z >0 \ times}\link{\underline{s}_i}{\underline{s}_o}.P_s$, if $s \in C_{i+1}$
\item[(h)] 
$P_s \defeq  \sum_{h\geq0} (\startchain{s_i}\chainedlink{s_o}{\noact}\chainend{\noact})^h
%{s_i}\chainedlink{s_o}{\noact}\chainend{\noact}...}_{v\ times}
\link{\underline{s}_i}{\underline{s}_o}.\overline{P}_s$, if $s \notin C_{i+1}$
\end{description}
where, by Lemma~\ref{lem:struct}.2, $h$ is the number of reactions requiring the presence of $s$ plus possibly some reactions not requiring $s$; and $k$ is the number of reactions producing $s$.

Similarly, the code executed by  $\overline{P}_s$ has the following structure:
\begin{description}
\item[(f')] 
$\overline{P}_s \defeq  \sum_{h,k\geq 0}(\startchain{\overline{s}_i}\chainedlink{\overline{s}_o}{\noact}\chainend{\noact})^h  \, \startchain{\widehat{s}_i}\chainedlink{\widehat{s}_o}{\noact}\chainend{\noact}
 (\startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact})^k\,.P_s $, if $s \in C_{i+1}$;
% \underbrace{ \startchain{\overline{s}_i}\chainedlink{\overline{s}_o}{\noact}\chainedlink{\noact}{\overline{s}_i}\chainedlink{\overline{s}_o}{\noact}\chainend{\noact}...}_{v\ times}\underbrace{ \startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainedlink{\noact}{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact}...}_{z\ times}\link{\widehat{s}_i}{\widehat{s}_o}.P_s $, if $s \in C_{i+1}$;
%\item[()] $P_s \defeq  \underbrace{ \startchain{s_i}\chainedlink{s_o}{\noact}\chainedlink{\noact}{s_i}\chainedlink{s_o}{\noact}\chainend{\noact}...}_{v\ times}\link{\widehat{s}_i}{\widehat{s}_o}.P_s $, if $s \in C_1$ %(and hence $s \in C_0'$)
\item[(g')] 
$\overline{P}_s \defeq  \sum_{h \geq 0,k\geq 1} (\startchain{\overline{s}_i}\chainedlink{\overline{s}_o}{\noact}\chainend{\noact})^h\ \startchain{\underline{s}_i}\chainedlink{\underline{s}_o}{\noact}\chainend{\noact} (\startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact})^k.P_s$, if $s \notin C_{i+1}$

% \underbrace{ \startchain{\overline{s}_i}\chainedlink{\overline{s}_o}{\noact}\chainedlink{\noact}{\overline{s}_i}\chainedlink{\overline{s}_o}{\noact}\chainend{\noact}...}_{v\ times}\underbrace{ \startchain{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainedlink{\noact}{\widetilde{s}_i}\chainedlink{\widetilde{s}_o}{\noact}\chainend{\noact}...}_{z >0 \ times}\link{\underline{s}_i}{\underline{s}_o}.P_s$, if $s \in C_{i+1}$
\item[(h')] 
$\overline{P}_s \defeq  \sum_{h \geq 0}(\startchain{\overline{s}_i}\chainedlink{\overline{s}_o}{\noact}\chainend{\noact})^h\,\link{\underline{s}_i}{\underline{s}_o}.\overline{P}_s$, if $s \notin C_{i+1}$
\end{description}
 \noindent
where, by Lemma~\ref{lem:struct}.2, $h$ is the number of reactions requiring the absence of $s$ plus possibly some reactions  requiring $s$; and $k$ is the number of reactions producing $s$.
 
 
It is worth nothing that, depending on the presence ($P_s$) or the absence ($\overline{P}_s$) of each entity $s$, for each process $P_a$ (encoding a reaction $a$) the choice between the execution of the reaction code (points {\bf (a)}, {\bf (b)}, {\bf (c)}) or  the code expressing that reaction $a$ is not applicable (point {\bf (d)}) is deterministic.
Also, the building of the code of process $\mathit{Cxt}$ (points {\bf (e)}, {\bf (f)}), is univocally determined by the evolution of $\gamma$.
It derives that the trend followed by the processes $P_s$ (or $\overline{P}_s$) is also deterministic (points {\bf (f)}, {\bf (g)}, {\bf (h)} or {\bf (f')}, {\bf (g')}, {\bf (h')}), leading to $P' = \llbracket {\cal A},\gamma^1\rrbracket$.
 \end{proof}
 
%  \begin{corollary}[correctness 1]
% \label{cor:complet1}
% Let ${\cal A} = (S, A)$ be a rs, and let  $\pi=(\gamma,\delta)$ be a $n$-step interactive process in $A$, with
% $\gamma = C_0,\dots,C_n$ and $\delta = D_0,\dots,D_n$. Let   $P=[|{\cal A},\gamma|]$ be  its c\CNA~translation. We define $\pi' = (\gamma',\delta')$ with $\gamma' = C_0',\dots,C_{n-1}'$ and $\delta' = D_0',\dots,D_{n-1}'$ as $C_0' = C_1 \cup D_1$,  and
% $C_i' = C_{i+1}$, $D_{i}' = D_{i+1}$ with $ 1 \leq i < n$. Then,
% if $\exists$ $P'$, $P''$ such that $P \xrightarrow{\link{\silent}{\silent}} P'$ and $P \xrightarrow{\link{\silent}{\silent}} P''$, then $P' = P''$.
%\end{corollary}
% \begin{proof}
% %\noindent
%%{\bf Point 2.}\\
%By Definition~\ref{def:trans} if follows that:
%\begin{enumerate}
%\item for the processes $P_a$, the choice  between applying the behaviour
%corresponding of applying reaction $a$ or one of its negations is deterministic, as it depends on the presence of the required reactants ($P_s$) and the absence of its inhibitors ($\overline{P}_s$);
%\item the behaviour of processes $Cxt_s$ are deterministic, as their  behaviour is driven by the component 
%$\gamma$ of the corresponding reactive system.
%\end{enumerate}
%It derives that for each process $P_s$, its continuation ($P_s$ or $\overline{P}_s$) is deterministic.
%And we are done.
%
% \end{proof}
 
 
% \begin{proposition}[correctness2]
% \label{prop:correctness1}
% Let $P$ be a c\CNA \ process such that $\exists$ a $rs$ ${\cal A}$ and a $n$-step interactive process $\pi=(\gamma,\delta)$ with $\gamma =C_0,\dots,C_n$ and $\delta = D_0,\dots,D_n$ such that $P= [|{\cal A},\gamma|]$. 
% %We set $\pi'=(\gamma',\delta')$ with $\gamma'=C_0',\dots,C_{n-1}'$,  $\delta'=D_0',\dots,D_{n-1}$,  where $C_0'= C_1 \cup D_1$, $C_i'= C_{i+1}$, $D_i=D_{i+1}'$,  and $1 \leq i < n$.
%Then,   $\exists$ $P'$ and $\pi'=(\gamma',\delta')$ such that $P \xrightarrow{\link{\silent}{\silent}}P'$, $P' =[|{\cal A},\gamma'|]$.
% \end{proposition} 
% \begin{proof}
% By Lemma~\ref{lem:compl2},  $\exists !$ $P'$ such that $P \xrightarrow{\link{\silent}{\silent}}P'$.\\
% By Definition~\ref{def:trans}, $P= \restrict{reacts,ctxs,ents}(\Pi_{a \in A}P_a | \Pi_{s \in S}CXT_s|\Pi_{s\in C_0} P_s | \Pi_{s \notin C_0}\overline{P}_s)$.\\
% By Lemma~\ref{lem:struct}, \\$P' =  \restrict{reacts,ctxs,ents}(\Pi_{a \in A}P_a | \Pi_{s \in S}CXT_s|\Pi_{s\in C_1 \cup D_1} P_s | \Pi_{s \notin C_1 \cup D_1}\overline{P}_s)$ 
%  Then, we set $\gamma' = C_0',\dots,C_{n-1}'$ and $\delta'=D_0',\dots,D_n'$ as
%  We set $C_0'=C_1 \cup D_1$, $C_i' = C_{i+1}$, and $D_i' = D_{i+1}$, with $1 \leq  i < n-1$.
%  And we are done.
% \end{proof}
%
% 
% 

%\noindent
% We recall Corollary~\ref{corr:corr2}
%(the original appears on p.\,\pageref{corr:corr2}).
\corrcorrdue*

% \begin{corollary}[correcteness2]
% %\label{prop:correctness2}
%  Let $P$ a  c\CNA process such that exists a rs ${\cal A}$ and a $n$-step  interactive process $\pi=(\gamma,\delta)$ with $\gamma =C_0,\dots,C_n$ and $\delta = D_0,\dots,D_n$ such that $P= [|{\cal A},\gamma|]$. 
% %We set $\pi'=(\gamma',\delta')$ with $\gamma'=C_0',\dots,C_{n-1}'$,  $\delta'=D_0',\dots,D_{n-1}$,  where $C_0'= C_1 \cup D_1$, $C_i'= C_{i+1}$, $D_i=D_{i+1}'$,  and $1 \leq i < n$.
%Then,   $\exists$ $P''$ and $\pi''=(\gamma'',\delta'')$ such that $P \xrightarrow{\link{\silent}{\silent}}^{w-1}P''$, $P'' =[|{\cal A},\gamma''|]$.
%%such that $P=[|{\cal A}|]$, then if $P \rightarrow^* P'$, then $\exists$ ${\cal A'}$ such that ${\cal A}$  evolves in ${\cal A'}$ and $P'=[|{\cal A'}|]$.
% \end{corollary}
\begin{proof}
We proceed by induction on the transition number $j \geq 0$.
% case $j=0$\\
% It is enough to set $C_0' = C_0 \cup D_0$ and $P' =P$.\\
\begin{description}
\item[base case $j=1$:]
 This case falls into the case of Proposition~\ref{prop:corr1}.
\item[inductive case:]
We assume, by inductive hypothesis, that $\exists P'$ such that 
$$P \xrightarrow{\link{\silent}{\silent}\dots \link{\silent}{\silent}}^{j-1} P'$$ 
and $P' = \llbracket{\cal A},\gamma^{j-1}\rrbracket$.
%, with $1 \leq  i < t-1$.\\
As $P'$ is the encoding of an extended interactive process, by Proposition~\ref{prop:corr1}, it exists $P''$  such that $P' \xrightarrow{\link{\silent}{\silent}\dots\link{\silent}{\silent}} P''$,
 and $P'' = \llbracket{\cal A},\gamma^j\rrbracket$. 
% By Lemma~\ref{lem:compl2}.2, if $\exists$ $P'$ such that $P'' \xrightarrow{\link{\silent}{\silent}} P'$, then $P'$ is 
 %unique, and by Lemma~\ref{lem:compl2}.1 $P' = [|{\cal A},\gamma'|]$. 
%By Proposition~\ref{prop:corr1}, we know that  $C_0''=C_1' \cup D_1'$, $C_i''= C_{i+1}'$,
% and $D_i'' = D_{i+1}'$.  And we are done, as $C_0''=C_1' \cup D_1' = C_j \cup D_j$, $C_i''= C_{i+1}' = C_{i+j}$,  and $D_i'' = D_{i+1}'= D_{i+j}$.
\end{description}
\end{proof}

%\noindent
%We recall Proposition~\ref{prop:compl1}
%(the original appears on p.\,\pageref{prop:compl1}).
\propcompluno*

% \begin{proposition}[completeness1]
% \label{lem:compl2}
% Let ${\cal A} = (S, A)$ be a rs, and let  $\pi=(\gamma,\delta)$ be a $n$-step interactive process in $A$, with
% $\gamma = C_0,\dots,C_n$ and $\delta = D_0,\dots,D_n$. Let   $P=[|{\cal A},\gamma|]$ be  its c\CNA~translation. We define $\pi' = (\gamma',\delta')$ with $\gamma' = C_0',\dots,C_{n-1}'$ and $\delta' = D_0',\dots,D_{n-1}'$ as $C_0' = C_1 \cup D_1$,  and
% $C_i' = C_{i+1}$, $D_{i}' = D_{i+1}$ with $ 1 \leq i < n$. Then
% % following holds:
% %\begin{enumerate} 
% %\item  
% $\exists$ $P'$ such that $P \xrightarrow{\link{\silent}{\silent}} P'$ and  $P'=[|{\cal A},\gamma'|]$;
% %\item if $\exists$ $P'$, $P''$ such that $P \xrightarrow{\link{\silent}{\silent}} P'$ and $P \xrightarrow{\link{\silent}{\silent}} P''$, then $P' = P''$.
% %\end{enumerate}
% \end{proposition} 
 \begin{proof}
% {\bf Point 1.}\\
By Proposition~\ref{prop:corr1}, if there exists $P'$ such that $P\xrightarrow{\link{\silent}{\silent}\dots \link{\silent}{\silent} }P'$, then the structure of  $P'$ is deterministically computed.\\
Now, to prove that always exists $P'$, we observe that even in the case no reaction $a$ is applicable in  the interactive process $\pi$ in $A$, then process $P$ can always execute a step transition, as its subprocesses $P_a$ can always execute one of the {\em alternative code
for when reaction $a$ is not applicable} (see Definition~\ref{def:trans}, code for $P_a$ processes).

 
%The proof proceeds by cases on the possible evolution of each element  $s \in S$, 
%following the evolution from $C_0$ to $C_0'$.\\
%
% %Let  ${\cal A} = (S, A)$ be a reaction system and let $e$ be an element in the system.
% % Then 
%Let $\pi' = (\gamma', \delta')$ be the evolution of  $\pi$ after one step. There are four cases to be considered: \ 
% 1) \ $s \in C_0$, $s \in C_0'$; \ 2)\  $C_0 \in S$, $s \notin C_0'$; \ 3)\  $s \notin C_0$, $s \notin C_0'$; \ 4)\  $s \notin C_0$, $s \in C_0'$.\\
%
%
%Before considering each one of the four previous cases, we analyse the code structure of the processes
%involved in the c\CNA \ transition  mimicking the one step evolution from $C_0$ to $C_0'$.
%
%
%\noindent
%\underline{case  $s \in C_0$ and $s \in C_0'$}\\
%We have to prove that the process $P_s$ is a subprocess of $P'$.\\
%By hypothesis, one of the three following situations must have been took place:
%\begin{enumerate}
%\item at least one rule in $A$ producing the element $s$  has been applied, i.e. $s \in D_1$ (hence $s \in C_0'$), code of point {\bf (a)};
%\item the element $s$ has been provided by the context, i.e. $s \in C_1 $ (hence $s \in C_0'$), code of point {\bf (e)}
%\item both the previous cases 1) and 2)
%\end{enumerate}
%Also, some reaction $a \in A$, requiring the presence of the entity $s$, could have been applied, and all the rules requiring the absence of $s$ could not have been applied.\\
%%Then, let $R_i = [e';e'',e]$ be a rule producing $e$ with $e'' \neq e$, and let $i$ be its associated number. \\
%%By hypothesis, $s \in C_0'$, then it must be that at least a process with code structure of points {\bf (a)}or a process with code structure of point
%
%It follows that process $P_s$ has participated in the transition with code of point {\bf (f)} with $z \geq 0$, or with code of point {\bf (g)}. Then we have that  $P' \defeq \restrict{reacts,ctxs,ents}(P_s | B)$.\\
%
%\noindent
%The other cases can be proved in a  similar way.\\
\end{proof}
 
%\noindent
%We recall Corollary~\ref{corr:compl2}
%(the original appears on p.\,\pageref{corr:compl2}).
\corrcompldue*
 
% \begin{corollary}[completeness2]
% \label{prop:completeness}
%  Let ${\cal A} = (S, A)$ be a $rs$, and let $\pi=(\gamma,\delta)$ be a $n$-step interactive process in ${\cal A}$ with $\gamma = C_0,\dots,C_n$ and $\delta = D_0,\dots,D_n$. Let $P=[|{\cal A},\gamma|]$ its c\CNA \ translation. If we define $\pi'= (\gamma',\delta')$  with   $\gamma' = C_0',\dots,C_{n-1}'$ and $\delta' = D_0',\dots,D_{n-1}'$  as
%  $C_0'=C_w \cup D_w$, and   $C_i'=C_{i+w}$, $D_i' = D_{i+w}$ with $1 \leq i \leq n-w $, then $\exists$ $P'$ such that $P \rightarrow^w P'$ and  $P'=[|{\cal A},\gamma'|]$.  
% \end{corollary}
 \begin{proof}
 The proof proceeds by induction on the number $j$, and it is similar to the one of Corollary~\ref{corr:corr2}.\\
% case $j=0$\\
% It is enough to set $C_0' = C_0 \cup D_0$ and $P' =P$.\\
% case $j=1$\\
% This case falls into the case of Proposition~\ref{prop:compl1}.\\
% case $j>1$\\
% We set $C_0'=C_w \cup D_w = C_1'' \cup D_1''$, $C_g' = C_{n-w}= C_{g+1}''$, and $D_g' = D_{n-w} = D_{g+1}''$, with $1 \leq  g < n-w$.\\
% By inductive hypothesis, it holds that $\exists$ $P''$ such that $P \xrightarrow{\link{\silent}{\silent}}^{w-1} P''$ and $P'' = [| {\cal A},\gamma'|]$.
% By Lemma~\ref{lem:compl2}.1, it exists $P'$ such that $P'' \xrightarrow{\link{\silent}{\silent}} P'$,
% and $P' = [|{\cal A},\gamma'|]$. By Lemma~\ref{lem:compl2}.2, $P'$ is unique.
%% By Lemma~\ref{lem:compl2}.2, if $\exists$ $P'$ such that $P'' \xrightarrow{\link{\silent}{\silent}} P'$, then $P'$ is 
% %unique, and by Lemma~\ref{lem:compl2}.1 $P' = [|{\cal A},\gamma'|]$. 
% And we are done. 
 \end{proof}
 
 \theocorr*
 \begin{proof}
The proof is just an adaptation of the classical result. The two implications are proved separately.
\begin{description}
\item[$\sim_{\mathsf{F}}\ \subseteq\ \equiv_{\mathcal{L}_{\mathsf{F}}}$:]
Given any two processes $P\sim_{\mathsf{F}} Q$ we need to prove that for any bioHML formula $\mathsf{G}$ we have $P\entails \mathsf{G}$ iff $Q\entails \mathsf{G}$. 
Without loss of generality, we prove that $P\entails \mathsf{G}$ implies $Q\entails \mathsf{G}$.
The proof is by structural induction on $\mathsf{G}$.
\begin{itemize}
\item 
if $\mathsf{G}={\tt t}$, then $Q\entails \mathsf{G}$.

\item
if $\mathsf{G}={\tt f}$, then the assumption $P\entails \mathsf{G}$ is false and the implication holds.

\item
if $\mathsf{G}=\mathsf{G}_1 \wedge \mathsf{G}_2$ we take as inductive hypotheses that
$$
\begin{array}{l}
\forall R,S.\ R \sim_{\mathsf{F}} S \wedge R\entails \mathsf{G}_1 \Rightarrow S \entails \mathsf{G}_1\\
\forall R,S.\ R \sim_{\mathsf{F}} S \wedge R\entails \mathsf{G}_2 \Rightarrow S \entails \mathsf{G}_2
\end{array}
$$
We need to prove that $Q\entails \mathsf{G}$.
Since $P\entails \mathsf{G}=\mathsf{G}_1 \wedge \mathsf{G}_2$ we have $P\entails \mathsf{G}_1$ and $P\entails \mathsf{G}_2$.
Since $P\sim_{\mathsf{F}} Q$, by inductive hypotheses we get $Q\entails \mathsf{G}_1$ and $Q\entails \mathsf{G}_2$.
Hence $Q\entails \mathsf{G}_1 \wedge \mathsf{G}_2=\mathsf{G}$.


\item
if $\mathsf{G}=\mathsf{G}_1 \vee \mathsf{G}_2$  we take as inductive hypotheses that
$$
\begin{array}{l}
\forall R,S.\ R \sim_{\mathsf{F}} S \wedge R\entails \mathsf{G}_1 \Rightarrow S \entails \mathsf{G}_1\\
\forall R,S.\ R \sim_{\mathsf{F}} S \wedge R\entails \mathsf{G}_2 \Rightarrow S \entails \mathsf{G}_2
\end{array}
$$
We need to prove that $Q\entails \mathsf{G}$.
Since $P\entails \mathsf{G}=\mathsf{G}_1 \vee \mathsf{G}_2$ we have $P\entails \mathsf{G}_1$ or $P\entails \mathsf{G}_2$.
If $P\entails \mathsf{G}_1$, since $P\sim_{\mathsf{F}} Q$, by inductive hypotheses we get $Q\entails \mathsf{G}_1$ and thus $Q\entails \mathsf{G}_1 \vee \mathsf{G}_2=\mathsf{G}$.
If $P\entails \mathsf{G}_2$, since $P\sim_{\mathsf{F}} Q$, by inductive hypotheses we get $Q\entails \mathsf{G}_2$ and thus $Q\entails \mathsf{G}_1 \vee \mathsf{G}_2=\mathsf{G}$.

\item
if $\mathsf{G}=\langle\chi\rangle \mathsf{H}$ we take as inductive hypothesis that
$$
\forall R,S.\ R \sim_{\mathsf{F}} S \wedge R\entails \mathsf{H} \Rightarrow S \entails \mathsf{H}
$$
We need to prove that $Q\entails \mathsf{G}$.
Since $P\entails \langle\chi\rangle \mathsf{H}$ it means that there exists $\upsilon, P'$ such that $P\xRightarrow{\upsilon} P'$ with $\upsilon\entails \chi$ and $P'\entails \mathsf{H}$.
Since $P\sim_{\mathsf{F}} Q$, there exists $w,Q'$ such that $Q\xRightarrow{w} Q'$ with $w\entails \chi$ and $P'\sim_{\mathsf{F}} Q'$. Then, by inductive hypothesis, $Q'\entails \mathsf{H}$ and thus $Q\entails \langle\chi\rangle \mathsf{H}=\mathsf{G}$.

\item
if $\mathsf{G}=[\chi] \mathsf{H}$ we take as inductive hypothesis that
$$
\forall R,S.\ R \sim_{\mathsf{F}} S \wedge R\entails \mathsf{H} \Rightarrow S \entails \mathsf{H}
$$
We need to prove that $Q\entails \mathsf{G}$.
If there is no $\upsilon\entails \chi$ such that $Q\xRightarrow{\upsilon}Q'$ for some $Q'$, then 
 $Q\entails [\chi] \mathsf{H}=\mathsf{G}$ trivially.
For any $\upsilon,Q'$ such that $Q\xRightarrow{\upsilon}Q'$ with $\upsilon\entails \chi$, then as $P\sim_{\mathsf{F}} Q$ there must exist $w,P'$ such that $P\xRightarrow{w}P'$ with $w\entails \chi$ and $P'\sim_{\mathsf{F}} Q'$. Since $P\entails \mathsf{G}=[\chi] \mathsf{H}$ then it must be $P'\entails \mathsf{H}$. Since $P'\sim_{\mathsf{F}} Q'$, by inductive hypothesis $Q'\entails \mathsf{H}$. Hence $Q\entails [\chi] \mathsf{H} = \mathsf{G}$.
\end{itemize}

\item[$\equiv_{\mathcal{L}_{\mathsf{F}}}\ \subseteq\ \sim_{\mathsf{F}}$:]
We prove that $\equiv_{\mathcal{L}_{\mathsf{F}}}$ is a bio-simulation and thus included in $\sim_{\mathsf{F}}$.
Take two generic processes $P\equiv_{\mathcal{L}_{\mathsf{F}}} Q$ and suppose $P\xRightarrow{\upsilon}P'$ for some $\upsilon,P'$. 
\begin{itemize}
\item
If $\upsilon \entails \mathsf{F}$ we want to prove that there exists some $w,Q'$ such that $Q\xRightarrow{w}Q'$, with $w\entails \mathsf{F}$ and $P'\equiv_{\mathcal{L}_{\mathsf{F}}} Q'$.

Towards a contradiction, assume that we cannot find such $w,Q'$.

If there is no transition $Q\xRightarrow{w}Q'$ such that $w\entails \mathsf{F}$, then the bioHML formula $\mathsf{G} \defeq \langle \mathsf{F}\rangle{\tt t}$ is such that $P\entails \mathsf{G}$ and $Q\not\entails \mathsf{G}$, contradicting the assumption $P\equiv_{\mathcal{L}_{\mathsf{F}}} Q$.

Otherwise, let $\mathcal{Q}\defeq \{Q'~\mid~\exists w.\ Q\xRightarrow{w}Q' \ \wedge\ w\entails \mathsf{F}\}$ be the (non-empty) set of processes reachable from $Q$ via a transition with a (complete) label that satisfies $\mathsf{F}$. Since our processes are with guarded recursion, the set $\mathcal{Q}$ is finite. Let $\mathcal{Q} = \{Q'_1,...,Q'_n\}$. By hypothesis all processes in $\mathcal{Q}$ must not be bio-logically equivalent to $P'$, hence for any $i\in[1,n]$ there exists a bioHML formula $\mathsf{G}_i$ such that $P'\entails \mathsf{G}_i$ and $Q'_i\not\entails \mathsf{G}_i$ (if it was the opposite, $P'\not\entails \mathsf{H}_i$ and $Q'_i\entails \mathsf{H}_i$ for some $\mathsf{H}_i$, we can use the converse formula $\mathsf{G}_i\defeq \overline{\mathsf{H}}_i$). But then the formula $\mathsf{G}\defeq \langle \mathsf{F}\rangle(\mathsf{G}_1\wedge\dots\wedge \mathsf{G}_n)$ is such that $P\entails \mathsf{G}$ and $Q\not\entails \mathsf{G}$, contradicting the assumption $P\equiv_{\mathcal{L}_{\mathsf{F}}} Q$.

\item
If $\upsilon \not\entails \mathsf{F}$ then the proof is analogous to the previous case (by exploiting $\neg \mathsf{F}$) and thus omitted.
\end{itemize}
\end{description}
\end{proof}

 
 